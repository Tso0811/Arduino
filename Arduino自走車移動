#include <SoftwareSerial.h>
int spd = 38;               // 設定速度值0-255
int timer = 1000;           // 定義整數 timer
SoftwareSerial BT(13,12);   // 接收腳(RX), 傳送腳(TX)；接HC-06之TXD、RXD；先不要用0,1,因為USB用
char command;

const int IN1 = 10;          //L298N IN1 pin 連接 Arduino pin 10 左馬達
const int IN2 = 11;          //L298N IN2 pin 連接 Arduino pin 11 左倒退
const int IN3 = 6;           //L298N IN3 pin 連接 Arduino pin 5  右馬達
const int IN4 = 5;            //L298N IN4 pin 連接 Arduino pin 6

void setup() 
{
  Serial.begin(9600);     //確認藍牙傳輸速率 9600 bits/second
  pinMode(6,OUTPUT);      // Arduino 輸出電壓控制車子
  pinMode(5,OUTPUT);
  pinMode(11,OUTPUT);
  pinMode(10,OUTPUT);
  delay(500);  
  BT.begin(9600); 
}

void loop() {     
  if (BT.available() > 0) {
    command = BT.read();

    switch (command) {
      case 'g' : // 接收到 'w'，前進
        Forward();
        break;
      case 'b' : // 接收到 'x'，後退
        Back();
        break;
      case 'l' : // 接收到 'a'，左轉
        Left();
        break;
      case 'r' : // 接收到 'd'，右轉
        Right();
        break;
      case 's' : // 接收到 's'，停止馬達
        Stop();
        break;
      }
      }


}

void Forward(void)          //車子前進子程式
{
  analogWrite(IN1, spd);
  analogWrite(IN2, 0);
  analogWrite(IN3, spd);
  analogWrite(IN4, 0);
} 

void Back(void)              //車子後退子程式
{
  analogWrite(IN1, 0);
  analogWrite(IN2, spd);
  analogWrite(IN3,0 );
  analogWrite(IN4, 1);
} 

void Stop(void)              //車子停止子程式
{
  analogWrite(IN1, 0);
  analogWrite(IN2, 0);
  analogWrite(IN3, 0);
  analogWrite(IN4, 0);
}

void Right(void)              //車子左轉子程式
{
  analogWrite(IN1, spd);      //左馬達
  analogWrite(IN2, 0);    
  analogWrite(IN3, 0);
  analogWrite(IN4, 0);
} 

void Left(void)             //車子右轉子程式
{
  analogWrite(IN1, 0);
  analogWrite(IN2, 0);
  analogWrite(IN3, spd);   //右馬達
  analogWrite(IN4, 0);
} 
